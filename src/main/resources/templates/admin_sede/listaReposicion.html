<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords" content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>SaintMedic</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets_superAdmin/img/PastillaSinFondo.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/css/bootstrap.min.css">

    <!-- animation CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/css/animate.css">

    <!-- Select2 CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/plugins/select2/css/select2.min.css">

    <!-- Datatable CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/css/dataTables.bootstrap4.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/assets_superAdmin/plugins/fontawesome/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Main CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/css/style.css">
    <style>
        /* Para el title*/
        /*
        #text-container {
            position: relative;
        }

        #glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Evita que el brillo interfiera con el texto
        }
        */
        /*suave con borrar lo anterior*/
        table {
            border-collapse: collapse;
            width: 100%;
            background-color: #f9f9f9; /* Color de fondo suave */
            border-radius: 8px; /* Bordes redondeados */
            overflow: hidden; /* Ocultar bordes redondeados en las esquinas */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra suave */
        }

        th, td {
            padding: 12px 15px; /* Espaciado interior */
            text-align: left; /* Alineación del texto */
            border-bottom: 1px solid #ddd; /* Borde inferior */
        }

        th {
            background-color: #ff8c00; /* Color de fondo de la cabecera */
            color: white; /* Color del texto de la cabecera */
        }

        tr:hover {
            background-color: #f2f2f2; /* Cambio de color al pasar el ratón */
        }
    </style>

    <style>

        .btn-shine {
            text-align: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 12px 48px;
            color: #fff;
            background: linear-gradient(to right, #FF9F43 0, #FF6F43 10%, white 10%);
            background-position: 0;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 3s infinite linear;
            animation-fill-mode: forwards;
            -webkit-text-size-adjust: none;
            font-weight: 600;
            font-size: 16px;
            text-decoration: none;
            white-space: nowrap;
            font-family: "Poppins", sans-serif;
        }
        @-moz-keyframes shine {
            0% {
                background-position: 0;
            }
            60% {
                background-position: 180px;
            }
            100% {
                background-position: 180px;
            }
        }
        @-webkit-keyframes shine {
            0% {
                background-position: 0;
            }
            60% {
                background-position: 180px;
            }
            100% {
                background-position: 180px;
            }
        }
        @-o-keyframes shine {
            0% {
                background-position: 0;
            }
            60% {
                background-position: 180px;
            }
            100% {
                background-position: 180px;
            }
        }
        @keyframes shine {
            0% {
                background-position: 0;
            }
            60% {
                background-position: 180px;
            }
            100% {
                background-position: 180px;
            }
        }
    </style>

</head>
<body>
<div id="global-loader" >
    <div class="whirly-loader"> </div>
</div>
<!-- Main Wrapper -->
<div class="main-wrapper">

    <!-- Header -->
    <div th:replace="headerAdminSede"> </div>

    <!-- Header -->

    <!--sideBar-->
    <div th:replace="sidebarAdmin :: sidebarAdmin(activeTab = 'listaReposicion')"> </div>
    <!-- /Sidebar -->
    <div class="page-wrapper">
        <div class="content">
            <div class="page-header">
                <div class="page-header">
                    <div class="page-title">
                        <h2>Solicitudes de reposición</h2>
                        <h6>Aquí podrás observar los distintos pedidos de reposición que se hayan realizado. Adicionalmente podrás editarlos o cancelarlos antes del estado de empaquetado</h6>
                    </div>
                </div>
            </div>
            <!-- /product list -->
            <div class="card">
                <div class="card-body">
                    <div class="table-top">
                        <div class="search-set">
                            <div class="search-path">
                                <a class="btn btn-filter" >
                                    <img src="/assets_superAdmin/img/icons/search-white.svg" alt="img">
                                </a>
                            </div>
                            <div class="search-input"  >
                                <a class="btn btn-searchset" placeholder="buscar..." ><img src="/assets_superAdmin/img/icons/search-white.svg" alt="img"></a>
                            </div>
                        </div>
                        <div class="wordset">
                            <ul>
                                <li>
                                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="csv"><img src="/assets_superAdmin/img/icons/excel.svg" alt="img"></a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table datanew">
                            <thead>
                            <tr>
                                <th>Identificador</th>
                                <th>Detalles</th>
                                <th>Fecha de llegada</th>
                                <th>Estado del pedido</th>
                                <th>Editar</th>
                            </tr>
                            </thead>
                            <tbody >
                            <tr th:each="repo, vEstado: ${listaReposicion}">
                                <td th:text="${repo.idReplacementOrder}"></td>
                                <td class="productimgname" style="text-align: center;">
                                    <a  th:id="|${repo.idReplacementOrder}|"  type="button" class="product-img" >
                                        <img  src="../assets_pacient/img/icons/prescription2.svg" alt="product">
                                    </a>
                                </td>
                                <!--
                                <td><span class="badges bg-lightgreen" th:if="${repo.getTrackingState()} == 'Entregado' " th:text="${repo.getTrackingState()}" ></span></td>
                                <td><span class="badges bg-lightgreen" th:if="${repo.getTrackingState()} == 'En ruta' " th:text="${repo.getTrackingState()}" ></span></td>
                                <td><span class="badges bg-lightgreen" th:if="${repo.getTrackingState()} == 'Empaquetado' " th:text="${repo.getTrackingState()}" ></span></td>
                                <td><span class="badges bg-lightgreen" th:if="${repo.getTrackingState()} == 'En Proceso' " th:text="${repo.getTrackingState()}" ></span></td>
                                <td><span class="badges bg-lightgreen" th:if="${repo.getTrackingState()} == 'Solicitado' " th:text="${repo.getTrackingState()}" ></span></td>
                                -->
                                <td th:text="${repo.getReleaseDate()}"></td>
                                <td><span class="badges bg-lightgreen" th:text="${repo.getTrackingState()}" ></span></td>

                                <td th:if="${repo.getTrackingState() == 'Solicitado'  || repo.getTrackingState() == 'En Proceso'}">
                                    <a class="me-3" href="#">
                                        <img src="/assets_superAdmin/img/icons/edit.svg" th:id="|idPedidoEditar${repo.getIdReplacementOrder()}|" alt="img">
                                    </a>
                                    <a class="me-3" th:id="|idPedido${repo.getIdReplacementOrder()}|">
                                        <img src="/assets_superAdmin/img/icons/delete.svg" alt="img">
                                    </a>
                                </td>
                                <td th:if="${!(repo.getTrackingState() == 'Solicitado'  || repo.getTrackingState() == 'En Proceso')}">
                                    -
                                </td>
                                <script th:inline="javascript" >
                                    $("#idPedidoEditar" + [[${repo.idReplacementOrder}]]).click( function() { data={
                                        idPedidoReposicion : [[${repo.idReplacementOrder}]]
                                    }
                                        $.ajax({
                                            url: "/verDetalleRepoMedicamentos",
                                            type: "POST",
                                            data: data,
                                            success:  function (response) {
                                                console.log(response);
                                                var Header = '<form id="A'+[[${repo.idReplacementOrder}]] +'" >'+ "<table class=\"table\">\n                                                                  <thead>\n                                                                    <tr>\n                                                                      <th>#</th>\n                                                                      <th>Nombre</th>\n                                                                                                                                           <th>Precio</th>\n                                                                      <th>Cantidad</th>\n                                                                    </tr>\n                                                                  </thead>\n                                                                  <tbody>";
                                                var rowx;
                                                var count = 1;
                                                var rows = "";
                                                response.forEach(function (producto) {
                                                    var aux = JSON.parse(producto)
                                                    rowx =
                                                        '<tr> ' +
                                                        '<td>' + count + '</td>'
                                                        +
                                                        '<td>' + aux.name + '</td>'
                                                        +

                                                        '<td>' + 's/.' + aux.price + '</td>'

                                                        +
                                                        '<td>' + "<input " + "id='" + aux.id + "'" + " type='number' value='" + aux.initial + "'>" + '</td>'
                                                        +
                                                        '</tr>'
                                                    ;
                                                    rows = rows + rowx + '</form>';
                                                    count++;
                                                })
                                                var final = "</tbody>\n                                                                </table>";
                                                console.log("HOLAAA1");
                                                const getInputs = () => {
                                                    return new Promise ((resolve, rejected)=>{
                                                        Swal.fire({
                                                            title: 'Medicamentos de la orden de reposición',
                                                            html: Header + rows + final,
                                                            confirmButtonText: "Editar",
                                                            cancelButtonText: "Regresar",
                                                            cancelButtonColor: "rgba(248,215,48,0.87)",
                                                            confirmButtonColor: "#dd986a",                                                            showCancelButton: true,
                                                            preConfirm: () => {
                                                                const inputs = [];
                                                                const form = document.querySelector('#A'+[[${repo.idReplacementOrder}]]);
                                                                form.querySelectorAll('input').forEach(input => {
                                                                    inputs.push(input.value);
                                                                });
                                                                resolve(inputs);
                                                            }
                                                        })
                                                    })
                                                }
                                                async function esperarPopUp (){
                                                    try {
                                                        const datosFetched = await getInputs();
                                                        console.log("Hola");
                                                        console.log(datosFetched);
                                                        const jsonString = JSON.stringify(datosFetched);
                                                        //Validaciones :D
                                                        var oli = [];
                                                        for(let i =0 ;  i<datosFetched.length ; i++ ){
                                                            try {
                                                                const numero = parseInt(datosFetched[i]); // Intenta parsear "texto" a un número
                                                                if(numero<=0){
                                                                    oli.push("ErrorTipoDeNumero");
                                                                }
                                                            } catch (error) {
                                                                oli.push("ErrorCasteo");
                                                            }
                                                        }
                                                        var countErrorTipoNumero = 0 ;
                                                        var countErrorCasteo = 0 ;
                                                        for(let j = 0 ; j<oli.length ;j++ ){
                                                            if(oli[j] === "ErrorTipoDeNumero" ){
                                                                countErrorTipoNumero++;
                                                            }
                                                            if(oli[j] === "ErrorCasteo" ){
                                                                countErrorCasteo++;
                                                            }
                                                        }
                                                        if(countErrorCasteo>0 ||countErrorTipoNumero >0 ){
                                                            Swal.fire({
                                                                icon: "error",
                                                                title: "Oops...",
                                                                iconColor: "rgba(248,108,48,0.87)",
                                                                confirmButtonColor: "rgb(190,129,129)",
                                                                text: "Ingresaste una cantidad incoherente!",
                                                            });
                                                        }else{
                                                            datosFetched.push([[${repo.idReplacementOrder}]]);
                                                            console.log(""+datosFetched);
                                                            $.ajax({
                                                                url:"/editarPedidoReposicionAdminSede",
                                                                data: JSON.stringify({ datos: datosFetched }),
                                                                type: "POST",
                                                                contentType: "application/json",
                                                                success:  window.location.href = "/verListaReposicion"
                                                            })
                                                        }
                                                    } catch (error) {
                                                        console.error(error);
                                                    }
                                                }
                                                esperarPopUp();
                                            },
                                        })
                                    })
                                </script>
                                <script th:inline="javascript" >
                                    $("#idPedido" + [[${repo.idReplacementOrder}]]).click( function() {

                                        Swal.fire({
                                            title: "¿Estás seguro de cancelar este pedido de reposición #"+ [[${repo.idReplacementOrder}]] + " ?",
                                            text: "Esta acción es irreversible",
                                            icon: "warning",
                                            iconColor: "#dd986a",
                                            showCancelButton: true,
                                            confirmButtonText: "Sí, lo deseo eliminar",
                                            //cancelButtonColor
                                            cancelButtonColor: "rgba(248,215,48,0.87)",
                                            confirmButtonColor: "#dd986a",
                                            cancelButtonText: "Regresar",
                                        }).then((result) => {
                                            if (result.isConfirmed) {
                                                window.location.href = '/cancelarPedidoReposicion?id='+ [[${repo.idReplacementOrder}]] ; // Aquí coloca la URL a la que quieres redirigir
                                            }
                                        });
                                    });
                                </script>

                                <script th:inline="javascript" >
                                    $("#" + [[${repo.idReplacementOrder}]]).click( function(){
                                        data={
                                            idPedidoReposicion : [[${repo.idReplacementOrder}]]
                                        }
                                        console.log("Hola");
                                        $.ajax({
                                            url: "/verDetalleRepoMedicamentos",
                                            type: "POST",
                                            data: data,
                                            success: function(response) {
                                                console.log(response);
                                                var Header = "<table class=\"table\">\n                                                                  <thead>\n                                                                    <tr>\n                                                                      <th>#</th>\n                                                                      <th>Nombre</th>\n                                                                                                                                           <th>Precio</th>\n                                                                      <th>Categoría</th>\n                                                                      <th>Cantidad</th>\n                                                                    </tr>\n                                                                  </thead>\n                                                                  <tbody>";
                                                var rowx ;
                                                var count = 1;
                                                var rows ="";
                                                response.forEach(function(producto){
                                                    var aux = JSON.parse(producto)
                                                    rowx = '<tr> ' +
                                                        '<td>'+ count +'</td>'
                                                        +
                                                        '<td>'+ aux.name +'</td>'
                                                        +

                                                        '<td>'+ aux.price +'</td>'
                                                        +
                                                        '<td>'+ aux.category +'</td>'
                                                        +
                                                        '<td>'+ aux.initial +'</td>'
                                                        +
                                                        '</tr>';
                                                    rows =rows+rowx;
                                                    count++;
                                                })
                                                var final = "</tbody>\n                                                                </table>";

                                                Swal.fire({
                                                    title: 'Medicamentos de la orden de reposición',
                                                    html: Header+rows+final,
                                                    confirmButtonColor: "#dd986a"
                                                })
                                            },
                                        })
                                    })
                                </script>



                            </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

<script>
    let text = document.querySelector('#title');
    const glow = document.querySelector('#path');

    const textPath = document.createElementNS('http://www.w3.org/2000/svg', 'textPath');
    textPath.setAttribute('href', '#title');
    textPath.textContent = text.textContent;

    glow.appendChild(textPath);

    const length = glow.getTotalLength();
    glow.style.strokeDasharray = length;
    glow.style.strokeDashoffset = length;

    // Animación
    glow.style.transition = 'stroke-dashoffset 2s ease-in-out';
    glow.style.strokeDashoffset = '0';
</script>


<!-- jQuery -->
<script src="/assets_superAdmin/js/jquery-3.6.0.min.js"></script>

<!-- Feather Icon JS -->
<script src="/assets_superAdmin/js/feather.min.js"></script>

<!-- Slimscroll JS -->
<script src="/assets_superAdmin/js/jquery.slimscroll.min.js"></script>

<!-- Datatable JS -->
<script src="/assets_superAdmin/js/jquery.dataTables.min.js"></script>
<script src="/assets_superAdmin/js/dataTables.bootstrap4.min.js"></script>

<!-- Bootstrap Core JS -->
<script src="/assets_superAdmin/js/bootstrap.bundle.min.js"></script>

<!-- Select2 JS -->
<script src="/assets_superAdmin/plugins/select2/js/select2.min.js"></script>

<!-- Datetimepicker JS -->
<script src="/assets_superAdmin/js/moment.min.js"></script>
<script src="/assets_superAdmin/js/bootstrap-datetimepicker.min.js"></script>

<!-- Sweetalert 2 -->
<script src="/assets_superAdmin/plugins/sweetalert/sweetalert2.all.min.js"></script>
<script src="/assets_superAdmin/plugins/sweetalert/sweetalerts.min.js"></script>

<!-- Custom JS -->
<script src="/assets_superAdmin/js/script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>
</html>