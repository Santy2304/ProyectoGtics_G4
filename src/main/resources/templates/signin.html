<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords" content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>Saint Medic</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets_superAdmin/img/PastillaSinFondo.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/css/bootstrap.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/assets_superAdmin/plugins/fontawesome/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Main CSS -->
    <link rel="stylesheet" href="/assets_superAdmin/css/style.css">
</head>
<body class="account-page">

<!-- Main Wrapper -->
<form method="post" class="main-wrapper" id="miFormulario"  th:action="@{/processLogin}" >
    <div class="account-content">
        <div class="login-wrapper">
            <div class="login-img">
                <img src="/assets_superAdmin/img/LogoCentral.jpeg" alt="img" >
            </div>
            <div class="login-content">
                <div class="login-userset">
                    <div class="login-logo">
                        <img src="/assets_superAdmin/img/LogoConLetras.png" alt="img">
                    </div>
                    <div class="login-userheading">
                        <h3>Inicia sesión</h3>
                        <h4>Por favor ingresa tu contraseña aquí</h4>
                    </div>
                    <div class="form-login">
                        <label>Correo</label>
                        <div class="form-addons">
                            <input id="email" type="email" name="email" placeholder="Ingresa tu correo" required  >
                            <img src="/assets_superAdmin/img/icons/mail.svg" alt="img">
                        </div>
                    </div>
                    <div class="form-login">
                        <label>Contraseña</label>
                        <div class="pass-group">
                            <input id="password" type="password" name="password" class="pass-input" placeholder="Ingresa tu contraseña" required>
                            <span class="fas toggle-password fa-eye-slash"></span>
                        </div>
                    </div>
                    <div class="form-login">
                        <div class="alreadyuser">
                            <h4><a href="/forgetPassword" class="hover-a">¿Olvidaste tu contraseña?</a></h4>
                        </div>
                    </div>
                    <div class="form-login">
                        <button class="btn btn-login" type="submit" id="inicioSesion" >Inicia sesión</button>
                    </div>
                    <div class="signinform text-center">
                        <h4>¿No tienes una cuenta? <a href="/crearCuenta" class="hover-a">Crea una</a></h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded',()=>{
        let nube = [[${FechaNube}]]
       console.log('Hora en la nube : '+ nube + '');
        let currentDate = new Date();

        let year = currentDate.getFullYear();
        let month = String(currentDate.getMonth() + 1).padStart(2, '0');
        let day = String(currentDate.getDate()).padStart(2, '0');
        let hours = String(currentDate.getHours()).padStart(2, '0');
        let minutes = String(currentDate.getMinutes()).padStart(2, '0');
        let seconds = String(currentDate.getSeconds()).padStart(2, '0');
        let formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        console.log('Hora de javascript: '+ formattedDate)
    });
</script>

<script>

    $(document).ready(function() {
        let formSubmitting = false;

        $("#miFormulario").submit(function (event) {
            //Validamos si esta baneado el usuario , en caso exista el usuario
            if (formSubmitting) return;
            event.preventDefault();
            var email = $("#email").val();
            var pass = $("#password").val();
            //Consulta ajax
            $.ajax({
                url: '/estaBaneado?email=' + email + '&password=' + pass,
                type: 'GET',
                success: function (response) {
                    var user = response;
                    console.log("hola")
                    console.log(response)
                    if ( ! user.state) {
                        console.log("Esta baneadoooo")
                        Swal.fire({
                            icon: "error",
                            iconColor: "orange",
                            title: "¡Estás baneado de esta página!",
                            confirmButtonColor: "#dd986a"
                        })
                    } else {
                        formSubmitting = true
                        $("#miFormulario").submit();
                    }
                }
                ,
                error: function () {
                    formSubmitting = true
                    $("#miFormulario").submit();
                }
            })


        });
    });

</script>
<!-- /Main Wrapper -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



<script type="text/javascript" th:if="${param.error}">
    document.addEventListener('DOMContentLoaded', function() {
        Swal.fire({
            icon: "error",
            iconColor: "orange",
            title: "¡Correo o contraseña incorrectos!",
            confirmButtonColor: "#dd986a"
        })
    });
</script>

</script>
<script src="/assets_superAdmin/js/jquery-3.6.0.min.js"></script>

<!-- Feather Icon JS -->
<script src="/assets_superAdmin/js/feather.min.js"></script>

<!-- Bootstrap Core JS -->
<script src="/assets_superAdmin/js/bootstrap.bundle.min.js"></script>

<!-- Custom JS -->
<script src="/assets_superAdmin/js/script.js"></script>

</body>
</html>